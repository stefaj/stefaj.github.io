<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      FunBlocks &middot; A functional block-based language for CodeWorld
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/funblocks/public/css/poole.css">
  <link rel="stylesheet" href="/funblocks/public/css/syntax.css">
  <link rel="stylesheet" href="/funblocks/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/funblocks/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/funblocks/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Visual functional block-based programming language for CodeWorld</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/funblocks/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    

<!--    <a class="sidebar-nav-item" href="https://github.com/stefan-j/FunBlocks/archive/v1.0.0.zip">Download</a> -->
    <a class="sidebar-nav-item" href="https://github.com/stefan-j/FunBlocks">GitHub project</a>
    <!-- <span class="sidebar-nav-item">Currently v1.0.0</span> -->
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2016. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/funblocks/" title="Home">FunBlocks</a>
            <small>A functional block-based language for CodeWorld</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/funblocks//2016/08/08/hsoc-conclusion-result/">
        Go on till you come to the end
      </a>
    </h1>

    <span class="post-date">08 Aug 2016</span>

    <p><em>A conclusion on the FunBlocks HSOC project</em></p>

<p>With the conclusion of <a href="https://summer.haskell.org/">Haskell Summer of Code</a> it’s time to wrap up everything
and talk about the result.</p>

<p>With this post, I’ll go through my Haskell Summer of Code 2016 project, what it
entailed and maybe a few thoughts on the subject.</p>

<h2 id="a-quick-review">A quick review</h2>
<p>The project entails the creation of a <em>functional</em> block-based programming language
for CodeWorld. The aim is to create a user-friendly educational environment where
students new to the concept of programming can familiarize themselves. Once
students reach a certain maturity they graduate to the <a href="https://code.world/">text-based CodeWorld
editor</a>.</p>

<p>The project roughly comprises out of the following:</p>

<ul>
  <li>A block based user interface in order to drag and drop blocks. (We use a
modified Blockly)</li>
  <li>Code generation in order to see the result of dragging and dropping blocks.</li>
  <li>Integration with CodeWorld in order to create CodeWorld applications and run
them.</li>
</ul>

<p>The CodeWorld language is embedded within Haskell and for this project we
generate a subset of it.</p>

<p>In order to showcase the project, I’ll go through some of the features.</p>

<h2 id="polymorphic-blocks">Polymorphic blocks</h2>

<p>Polymorphism is quite important and was required, for even a basic <code class="highlighter-rouge">if</code>
statement requires it.</p>

<p>For an <code class="highlighter-rouge">if</code> we have the type <code class="highlighter-rouge">Bool -&gt; a -&gt; a -&gt; a</code>.</p>

<p>Inputs are represented on the right side (external) or otherwise within the
block (internal). The output type is given on the left side of the block.</p>

<p>Internal style block:
<img src="http://stefanj.me/funblocks/assets/internal.png" alt="Interan Block" /></p>

<p>External style block:
<img src="http://stefanj.me/funblocks/assets/external.png" alt="External Block" /></p>

<p>Taking the <code class="highlighter-rouge">if</code> block as an example:
<img src="http://stefanj.me/funblocks/assets/ifblock.png" alt="If Block" /></p>

<p>We have a polymorphic type indicator for the types. The color being the same
indicates all of the types are the same type variable.</p>

<p>Once a block gets get connected, the most general type might be monomorphic,
which then updates the shape of the block:</p>

<p><img src="http://stefanj.me/funblocks/assets/monomorphic_example.png" alt="If Block" /></p>

<p>We can see that this is constraining the type variable <code class="highlighter-rouge">a</code> to <code class="highlighter-rouge">Number</code></p>

<h2 id="hindley-milner-type-inference">Hindley-Milner Type Inference</h2>
<p>I think I should’ve implemented this at the start. Throughout the project,
unification was a constant problem, with some blocks not always taking on the
correct type in the given context. Much roundabout effort was spent on something
that was replaced at the end.</p>

<p>What is Hindley-Milner ?</p>

<p>It is a simple type system for lambda calculus. For this
project, <em>algorithm W</em> was implemented in order to infer the types. A simple system
of tagging was used. We tag the connection types as the algorithm goes along,
and at the end apply the required substitutions.</p>

<p>Each block is given a lambda expression. This is usually just function application to the
base CodeWorld function. For example we might have a circle block with the
radius being <code class="highlighter-rouge">3</code>:</p>

<p><code class="highlighter-rouge">
(circle)(3)
</code></p>

<p>with <code class="highlighter-rouge">circle</code> having the type <code class="highlighter-rouge">circle : Number -&gt; Picture</code>.
Some blocks have more advanced expressions, such as the list block:</p>

<p><code class="highlighter-rouge">
a:(b:(c:[]))
</code></p>

<p>with <code class="highlighter-rouge">a</code>, <code class="highlighter-rouge">b</code>, and <code class="highlighter-rouge">c</code> being tagged with the correct connector block, and <code class="highlighter-rouge">[]</code>
simply being the empty list and is a placeholder.</p>

<p><img src="http://stefanj.me/funblocks/assets/listblock.png" alt="List Block" /></p>

<p>In the above list block, the polymorphic connectors in light blue would
correspond to <code class="highlighter-rouge">a</code>, <code class="highlighter-rouge">b</code> and <code class="highlighter-rouge">c</code>.</p>

<p>When we have an unconnected input we fill it with a placeholder undefined, with type <code class="highlighter-rouge">forall a. a</code>. 
This forces the expression to take its type as the output.</p>

<p>With the type system in place, it is much simpler to support new blocks, as we
simply have to define its expression. The previously an ad-hoc
approach was used which was based on most general unification. This involved
specific block-logic being scattered all over the place, in order to
determine the type correctly.</p>

<h2 id="codeworld-blocks">CodeWorld Blocks</h2>

<p>Since this project is for CodeWorld we do a few things differently from Haskell:</p>

<ul>
  <li>We add syntax symbols to blocks</li>
  <li>We follow the CodeWorld convention of having types tupled, for example, a
function call would be in the following form: <code class="highlighter-rouge">f(10, 20)</code></li>
</ul>

<p>CodeWorld makes learning programming easier by making it more visual. Students
can create pictures and animations by combining various functions. We provide
the same set of functions in the Blocks UI.</p>

<p>In order to build a simple tree the user snaps together some blocks:
<img src="http://stefanj.me/funblocks/assets/treeblocks.png" alt="Tree Blocks" /></p>

<p>In order to produce:</p>

<p><img src="http://stefanj.me/funblocks/assets/treeprogram.png" alt="Tree Program" /></p>

<p>An advantage of using a block based environment to do this is that it visually
indicates the user what is valid and what the program expects. Using different
connector shapes the user can see that a picture is required for the <code class="highlighter-rouge">drawingOf</code>
block, and that the colored block takes a picture and a color and outputs a
picture. This also makes it much more difficult to build invalid programs.</p>

<p>Some more tricky blocks to implement were the function block and the list
comprehension block, as they sometimes had odd edge cases (especially in the old
type system).</p>

<h2 id="local-variables">Local Variables</h2>
<p>Another thing we do differently from Blockly is to only allow instantiation of
variables from the defining parent.</p>

<p><img src="http://stefanj.me/funblocks/assets/localvariables.png" alt="Tree Program" /></p>

<p>In order to create the <code class="highlighter-rouge">x</code> variable in the picture above, the user can click and
drag the white shaded <code class="highlighter-rouge">x</code> (next to var). These variables also can’t be connected
to somewhere, where they are outside of their defining scope.</p>

<h2 id="user-defined-data-types">User-defined data types</h2>
<p>Users are able to create their own data types. They are based on algebraic data
types (they have to be, since it’s Haskell).</p>

<p>In order to create these, the user drags a data block with which he can add sum
components. A product component can then be attached.</p>

<p>A simple example would be</p>

<p><code class="highlighter-rouge">
data Temperature = Degrees Number
                 | Fahrenheit Number
</code></p>

<p>which is given in the Blocks environment as:
<img src="http://stefanj.me/funblocks/assets/usertypes.png" alt="Temperature usertype" /></p>

<p>Ideally, a single block would have captured the idea of an algebraic data types.
More work is needed on Blockly in order to support mixing inline input styles
with external input styles.</p>

<p>Once a user data type is created, corresponding constructor blocks, and case
blocks are added dynamically to the toolbox.</p>

<p>Currently, there is no support for higher kinded types.</p>

<h2 id="code-generation">Code generation</h2>

<p>The overall flow of the program is something akin to:</p>

<p><img src="http://stefanj.me/funblocks/assets/flowprogr.png" alt="Flow diagram" /></p>

<p>These backend components are implemented in Haskell, which run in the browser
thanks to <a href="https://github.com/ghcjs/ghcjs">GHCJS</a>.</p>

<p>Once a change occurs on the Blockly workspace we update on the event and build a
simple AST, which is something similar to:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>data Expr = LiteralS T.Text
          | LiteralN Float
          | LocalVar T.Text
          | CallFun T.Text [Expr]
          | FuncDef T.Text [T.Text] Expr
          ...
</code></pre>
</div>

<p>Once we have this, the code generation is simple and is mostly a matter of
formatting.</p>

<h2 id="miscellaneous">Miscellaneous</h2>

<p>Some other things that were implemented:</p>

<ul>
  <li>Some support for first class functions. Functions can be used as inputs. The
most important use case here is that the <code class="highlighter-rouge">animationOf</code>, <code class="highlighter-rouge">interactionOf</code>,
<code class="highlighter-rouge">simulationOf</code> program blocks require functions that specify the new state of
the world, event handling, drawing the world and so on.</li>
  <li>Project management - Projects can be saved and loaded. Programs can also be
shared by a URL. <a href="https://code.world/blocks#PHBEyguLbhv1ZhIpz-v6c5Q">A really simple
example</a>.</li>
  <li>Some basic help, which allows users to click on programs and load them into
the workspace.</li>
</ul>

<p>Some work also went into unseen things:</p>

<ul>
  <li>Improving performance</li>
  <li>Improving usability, stability, user-friendliness and error messages</li>
  <li>Ensuring that only (mostly) valid programs can be built.</li>
  <li>The gazillion bug fixes</li>
</ul>

<h1 id="hsoc">HSOC</h1>

<p>This project was part of this years <a href="https://summer.haskell.org/">Haskell Summer of
Code</a> initiative, which encourages contribution to
the Haskell community.</p>

<p>A big thanks to Edward Kmett, Ryan Trinkle and others who helped organize this
year’s program.</p>

<p>Another big thanks to my mentor Chris Smith, for his thorough bug tracking,
-reporting and overall guidance.
<a href="https://github.com/google/codeworld">CodeWorld</a> is his educational environment
and I’m glad to have contributed a component to it.</p>

<h1 id="conclusion">Conclusion</h1>

<p>Quite a lot of work went into the <a href="https://github.com/stefan-j/blockly">functional Blockly fork</a>. 
The CodeWorld functionality and -blocks are kept apart from the Blockly code, with
the Blockly fork mostly covering the functional features.</p>

<p>I’m not really sure how to measure the amount of work done. Some metrics at the time
of writing:</p>

<ul>
  <li>257 commits to the <a href="https://github.com/google/codeworld">CodeWorld repository</a></li>
  <li>395 commits to the <a href="https://github.com/stefan-j/blockly">Blockly fork</a></li>
</ul>

<p>Lines of code would have been inflated for Blockly, as it would have included
the build changes. Haskell also produces fewer lines of code.</p>

<p>The project was great and I enjoyed it. It has a few issues and bugs
that still need work. Overall I think it is in a good state for future work and
can be used as a foundation.</p>

<p>Some further work might include:</p>

<ul>
  <li>Finishing up user data types</li>
  <li>A guard block or guard functionality. Nesting <code class="highlighter-rouge">if</code>s can get tedious.</li>
  <li>Mixing internal and external inputs</li>
  <li>Live previewing of values</li>
  <li>Pattern matching</li>
</ul>

<p>I suggest you check out the result for yourself at:
<a href="https://code.world/blocks">code.world/blocks</a>. If you find any bugs or missing
features, kindly help us out and <a href="https://github.com/google/codeworld/issues">file an issue on the GitHub
tracker</a>.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/funblocks//2016/06/30/funblocks-prototype/">
        Fun Blocks Prototype
      </a>
    </h1>

    <span class="post-date">30 Jun 2016</span>

    <p>After looking up the constituent technologies which will be used for the
project, work on the initial prototype began.
For the initial version, we want a simple user interface with which simple
CodeWorld applications can be built.
Thus we want a version where a user can:</p>

<ul>
  <li>Drag and drop blocks from the toolbox</li>
  <li>Provide simple error feedback</li>
  <li>Generate code for a valid CodeWorld application</li>
  <li>Run the generated CodeWorld applications</li>
  <li>Saving and loading</li>
</ul>

<p>Some more advanced features which are omitted for this release are:</p>

<ul>
  <li>Support for functions</li>
  <li>Support for lists</li>
  <li>Advanced CodeWorld applications (animations, events)</li>
</ul>

<p>Simply put, we want a visual block-based interface which can be used to build
CodeWorld applications.</p>

<p>This project is educationally based. We want to introduce programming to younger
students and make it easy for them to understand the concepts behind it. For more
advanced projects students may use the <a href="https://code.world/">regular CodeWorld text
UI</a>.</p>

<p>The initial prototype can be found at
<a href="https://code.world/funblocks">code.world/funblocks</a></p>

<h2 id="blockly">Blockly</h2>
<p>This project relies heavily on <a href="https://developers.google.com/blockly/">Blockly</a> for the user interface.
Blockly provides an editor where blocks can be dragged and dropped on a canvas.
These blocks can then be interlocked with one another through a snapping behavior.</p>

<p>Blockly provides many features that make it easy to adapt to a new language. It
even incorporates simple type checking, luckily, however, there is a project that
improves Blockly’s type checking.</p>

<p>For the user-interface, the choice was made to keep the interface clean and
simple. 
The idea is to have a simple toolbar on the left-side with
blocks that can be dragged onto the canvas on the right.</p>

<p>Since the project uses
Blockly, blocks can be snapped into each other. A block has a single output and may have 
multiple inputs, each having a type.</p>

<p><img src="http://stefanj.me/funblocks/assets/translateBlock.png" alt="Translate Block" /></p>

<p>In the image above we can see a <code class="highlighter-rouge">Translated</code> block, taking a picture and two
numbers, and outputs another picture that is translated according to the given x
and y values.</p>

<p>Each block may have zero or more inputs
and one output type. All blocks are typed, and the functions in CodeWorld work on
immutable data structures. A function may take a color as an input to produce
another modified color. This works well with a visual block interface and we
can expressively see how the program flows.</p>

<p>Blockly provides a lot of features out of the box, though sometimes changes are
necessary specifically for this project.</p>

<p>The largest has been to use Anthony’s, which provides some useful typing and
polymorphic features though it also diverges from the main Blockly branch and is
almost 300 commits behind.</p>

<p>Other changes have been required as well, such as:</p>

<ul>
  <li>implementing the let blocks</li>
  <li>changing default methods of validation for numbers and function names</li>
  <li>adding error highlighting</li>
</ul>

<p>and other small changes and additions. Thus we maintain a <a href="https://github.com/stefan-j/blockly">separate fork of Blockly</a> for this
project.</p>

<h2 id="codegen">CodeGen</h2>
<p>When we build the program below:</p>

<p><img src="http://stefanj.me/funblocks/assets/drawingProgram.png" alt="Drawing of " /></p>

<p>we obtain the output code of:</p>

<p><code class="highlighter-rouge">
main = drawingOf(rotated(colored(solidRectangle(7,5), white),(60 + 70) * 0.9) &amp; solidCircle(4))
</code></p>

<p>Which looks rather ugly, but code formatting will be addressed at a later stage.</p>

<p>Currently, the regular Blockly code generation paradigm is followed, where a code generation function
is given for each block, that converts the block into code.
For a single block, we convert all input blocks to code, which are then combined
into a single block of code. This process is repeated for all top-level blocks.</p>

<p>For each block, a generation function is assigned, which looks something like
this:</p>

<p><code class="highlighter-rouge">
blockSector :: GeneratorFunction
blockSector block = do
    startangle &lt;- valueToCode block "STARTANGLE" CNone
    endangle &lt;- valueToCode block "ENDANGLE" CNone
    radius &lt;- valueToCode block "RADIUS" CNone
    return $ none $ "sector(" ++ startangle ++ "," ++ endangle ++ "," ++ radius ++ ")"
</code></p>

<p>This approach has some disadvantages, such being:</p>

<ul>
  <li>Difficult to ensure code is consistent and that all types match.</li>
  <li>Difficult to find errors when they occur</li>
  <li>Having to define a block for every CodeWorld function</li>
</ul>

<p>The first problem is alleviated with a different version of <a href="https://github.com/UCSD-PL/typed-blockly">Blockly that
supports polymorphic types</a>. I’m using
an <a href="https://github.com/awmorp/blockly">updated version by Anthony</a> that also support automatic coloring of Blocks.
Hence the strategy currently taken is to prevent errors through the block based
editor.</p>

<p>This version of Blockly fits this project great. Since we don’t have
side-effects the <em>type</em> of the <code class="highlighter-rouge">if</code>-block should be of the same as the <code class="highlighter-rouge">then</code> or <code class="highlighter-rouge">else</code>
expressions. In order to have a single <code class="highlighter-rouge">if</code> block, it must be polymorphic, and this
is provided by the alternate Blockly.</p>

<p><img src="http://stefanj.me/funblocks/assets/if1.png" alt="If Text" />
Above we can see the if block matching the Text type; below we can see the if
block matching the Picture type.
<img src="http://stefanj.me/funblocks/assets/if2.png" alt="If Picture" /></p>

<p>Regardless, the generated code is then displayed and syntax highlighted using
<a href="https://codemirror.net/">CodeMirror</a>.</p>

<p>The generated code is sent to the CodeWorld server, which compiles the code
into JavaScript. The compiled code is then run in the browser and displayed on
an HTML canvas.</p>

<p><img src="http://stefanj.me/funblocks/assets/previewproto.png" alt="Preview" /></p>

<h2 id="error-handling">Error handling</h2>
<p>First priority is to prevent a large class of errors from ever occurring.
This is done by only allowing certain connections between blocks, validating
input, providing default blocks and so on. 
This makes it easy for the user to construct valid programs.</p>

<p>However, errors do happen. What happens when a block contains a disconnected
input ?</p>

<p>In this version, we visually indicate at which block the error occurs and display
an error message for the block. This can be seen in the picture below.</p>

<p><img src="http://stefanj.me/funblocks/assets/error_disconnected.png" alt="Error" /></p>

<p>Some other errors, such as runtime errors will be addressed at a later stage.
Luckily, we currently don’t have missing patterns or partial functions to check for.</p>

<h2 id="project-management">Project Management</h2>
<p>Project management falls in line with the way things are currently done with the
regular CodeWorld site.</p>

<p>Blockly supports exporting the current workspace as XML. This XML is then sent
to the server and a hash is returned. This hash identifies a CodeWorld
FunBlocks application. For example
<a href="https://code.world/funblocks#PN2GoG8W2OMugJrzTw0GKYA">code.world/funblocks#PN2GoG8W2OMugJrzTw0GKYA</a>
loads a drawing of a coordinate plane.</p>

<p>Google’s authentication API can be used to log in. Once a user is logged in he
can then save and load his projects by name as well.</p>

<h2 id="issues--problems">Issues / Problems</h2>
<p>A large majority of the project is in JavaScript, this includes the Blockly
library.</p>

<p>Originally I intended to keep the majority of the code in Haskell, however, this
is difficult to do. Currently, there is a large part of additional code for
Blockly and an additional JavaScript file that handles the user interface
initialization and logic.</p>

<p>Most of the code that define the various types of Blocks are in a Haskell
file. However, some more standard blocks such as the math number block (which
included some validation) are modified from the regular Blockly code base. The
let definition is also modified Blockly code.</p>

<p>Thus organisationally, similar features and code are split between the main
project and the Blockly fork.</p>

<p>Another issue currently is the renaming of caller blocks for Let definitions.
When a Let definition is renamed the callerb blocks should get renamed as well.
This currently disabled as Blockly is sometimes calling the text input validator
for the wrong block, which tries to rename all of <em>foo’s</em> blocks to <em>bar</em>.</p>

<p>The block type unification for the Let definition is also currently producing
strange results and the issues on this are covered in the <a href="https://github.com/google/codeworld/issues/186">issue
tracker</a>.</p>

<h2 id="further-work">Further Work</h2>
<p>Currently, we are only able to build very simple programs. For more complicated
applications such as animations, we require first class functions. We also need
to cover more advanced data types. A starting point would be to cover lists and
tuples.</p>

<p>For CodeWorld simulations, the user is required to supply his own world data type, and
a user-friendly way is needed for the user to build these in the Blocks UI.</p>

<p>Some more advanced functional features such as pattern matching would make this
easier, and it remains to be seen how this will be implemented.</p>

<p>Everything is currently on track, which might mean we will get to spend time on
same of the more advanced features later.</p>

<h2 id="ghcjs">GHCJS</h2>

<p>Working on the project I’m exposed to
GHCJS and JavaScript a lot and I really like what GHCJS is doing. JavaScript has
a tendency to let anything almost work and I spend a lot of time debugging and
finding JS errors when working on Blockly code.</p>

<p>Straight after starting out I decided to try and keep the bulk of the work in
Haskell, which meant using GHCJS. 
The GHCJS ecosystem lacks good documentation and sometimes in order to
accomplish things that are simple in JS, a lot of time has to be spent navigating through 
many files of GHCJS code and a bit of luck.
One such is an example is when you want to assign a higher order function in
JS:</p>

<p><code class="highlighter-rouge">
Blockly.FunBlocks["block_number"] = function(block){...}
</code></p>

<p>where we want to assign a function to do the code generation for the block
indexed as “block_number”</p>

<p>Which involved looking at <a href="https://github.com/ghcjs/ghcjs-base/blob/master/GHCJS/Foreign/Callback.hs">GHCJS callback source
files</a>
, even though there are <a href="http://stackoverflow.com/questions/19415306/ghcjs-how-do-i-import-a-high-order-javascript-function-using-ffi">Stackoverflow questions regarding similar
issues</a>, the
GHCJS project is fast moving and the libraries keep changing.</p>

<h2 id="haskell-summer-of-code">Haskell Summer of Code</h2>
<p>I would like to say thanks for being part of this year’s <a href="https://summer.haskell.org/">Haskell Summer of
Code</a>
as I’m enjoying working the project quite a bit. Thanks goes to all of those who
made it possible as well.</p>

<p>I think the way the project is managed is quite good. We (me and my mentor,
Chris Smith) are primarily
communicating through emails and Github.
Working on Github helps a lot and the issue system greatly helps manage the
project. It helps when you want to have some idea or goal to work on or if you
want to fix something quickly. It’s too easy to forget about a minor bug if it
isn’t written down somewhere.</p>

<p>Chris has also been a great help testing new features, providing feedback,
opening issues and reporting bugs (which sometimes are a lot, I apologize !) and
providing overall direction for the project.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/funblocks//2016/05/28/hello-blockly/">
        Hello Blockly
      </a>
    </h1>

    <span class="post-date">28 May 2016</span>

    <h2 id="blockly">Blockly</h2>
<p>Officially, HSOC projects start from the 13th June. This provides time 
to do some research. Today I decided to take a look at Blockly.</p>

<p>Setting up Blockly is rather straightforward. I cloned Blockly as a 
git submodule.
I created a simple HTML page with a Blockly canvas. Setting up
Blockly involves <a href="https://developers.google.com/blockly/guides/configure-blockly/web/fixed-size">creating a static sized div and loading the
javascript</a>.
Later I will set it up as a resizable workspace.
Blockly comes with a javascript CodeGen, later I will have to 
implement a
Haskell/CodeWorld CodeGen for the project.</p>

<h2 id="codeworld">CodeWorld</h2>
<p>Following the advice on the
<a href="https://github.com/google/codeworld/blob/master/README.md">README</a> I 
created a new codeworld Linux user account and
went on to set up CodeWorld.
The current build script for CodeWorld covers the zypper, apt-get and yum
package managers. 
Running Arch I’ve got pacman. I already had most the required packages 
(git, zlib, ncurses, gcc, gmp, patch, autoconf, automake, openssl).</p>

<p>What I was missing was</p>

<p><code class="highlighter-rouge">
pacman -S npm nodejs
</code></p>

<p>I also had GHC 7.10.3 and cabal already installed.</p>

<p>Installing GHCJS:</p>

<p><code class="highlighter-rouge">
git clone https://github.com/ghcjs/ghcjs.git
cabal install ./ghcjs
ghcjs-boot
</code></p>

<p>and also ghcjs-dom</p>

<p><code class="highlighter-rouge">
cabal install ghcjs-dom
</code></p>

<p>I don’t have the cabal bin in my PATH so I needed:</p>

<p><code class="highlighter-rouge">
export PATH=/home/codeworld/.cabal/bin:$PATH
</code>
before running the standard CodeWorld build script. After running 
<code class="highlighter-rouge">build.sh</code>, <code class="highlighter-rouge">run.sh</code> started up the web server. 
Everything ran fine, minus saving projects, which I did not set up.</p>

<h2 id="ghcjs">GHCJS</h2>
<p>I wanted to play around with GHCJS as well, having never used it 
before.
Documentation was rather scarce but I managed to put together a simple 
hello world application; with a compiled js file of about 43KLOC.</p>

<p>A lot of the sample programs found were using an old version of 
GHCJS-DOM. I will return to GHCJS when I start programming on the project.</p>

<h2 id="testing-testing">Testing, testing</h2>

<p>My goal today was to quickly set a simple page containing Blockly and 
a CodeWorld application as a simple test.</p>

<p>I created a simple HTML file with Bootstrap for minimal styling, added 
Blockly and an iframe for running a standard CodeWorld application.</p>

<p>Setting up the example Snap site comprises of:</p>

<p>```
module Main where</p>

<p>import Control.Applicative
import Snap.Core
import Snap.Http.Server
import Snap.Util.FileServe
import Snap.Util.FileUploads
import System.Directory
import System.FilePath</p>

<p>main :: IO ()
main = quickHttpServe site</p>

<p>site :: Snap ()
site =
        ifTop (writeBS “hello world”) &lt;|&gt;
        route [ (“foo”, writeBS “bar”)
               ,(“echo/:echoparam”, echoHandler)
               ] &lt;|&gt;
        serveDirectory “web”</p>

<p>echoHandler :: Snap ()
echoHandler = do
    param &lt;- getParam “echoparam”
    maybe (writeBS “must specify echoparam in URL”)
          writeBS param
```</p>

<p>With the server looking for a page to serve from “web” if it does not 
match any of the routes.</p>

<p>I originally wanted to send a code sample from the FunBlocks page to 
the locally hosted CodeWorld server with a XMLHttpRequest, however, this I could not do 
as the FunBlocks site and CodeWorld server were on different ports, thus I ended up receiving</p>

<p><code class="highlighter-rouge">
XMLHttpRequest cannot load. No 'Access-Control-Allow-Origin' header is 
present on the requested resource.
Origin is therefore not allowed access
</code></p>

<p>as an error.</p>

<p>Not wanting to mess around with headers I decided to just copy over
the codeworld-server files and serve the same resources, with the new 
index page as an addition.</p>

<p>I actually only wanted the compile and run features for this simple 
test. 
So currently the server is exactly the same as the codeworld-server 
with a modified codeworld.js and custom index.
This makes things easy as FunBlocks can be hosted together with 
CodeWorld later, just on a different page.
I would enjoy having a solid implementation for the language.</p>

<p>Any thoughts on a good approach to take with this are welcome.</p>

<h2 id="type-checking-and-an-intermediate-form">Type checking and an intermediate form.</h2>
<p>The flow of the language will be something similar to:</p>

<p><em>Blocks -&gt; Intermediate code representation -&gt; CodeGen</em></p>

<p>The intermediate code representation should cover a basic set of 
features of
Haskell, enough to be able to generate valid CodeWorld applications. 
User friendliness is also a concern, since the project is 
educationally focussed.</p>

<p>Blocks should snap properly and maybe display suitable error
messages otherwise. For this to occur however, some form of type 
checking will have to be implemented.</p>

<p>I gathered some resources which I will look at later:</p>

<ul>
  <li><a href="http://web.cecs.pdx.edu/~mpj/thih/">Typing Haskell in Haskell</a> - Haskell type checking</li>
  <li><a href="http://hackage.haskell.org/package/hint-0.5.2">Hint</a> - Type-check and evaluate strings with Haskell expressions and even coerce them into values.</li>
  <li><a href="http://cs.brown.edu/~sk/Publications/Books/ProgLangs/2007-04-26/">Programming languages</a> - covers Racket, contains a chapter on type 
checking</li>
  <li><a href="http://research.microsoft.com/en-us/um/people/simonpj/papers/slpj-book-1987/">The Implementation of Functional Programming 
Languages</a> - Contains a chapter on Polymorphic type checking</li>
  <li><a href="http://hackage.haskell.org/package/baskell">Baskell</a> - A small functional language featuring type inference.</li>
</ul>

<p>The easiest might be to rely on Hint to type check Haskell expressions 
and do some backtracing, this avoids having to implement type inference. 
Though if time allows I might be tempted to do a proper implementation.</p>

<p>Most CodeWorld functions are monomorphic and have concrete types, with 
some exceptions (simulations). So some part of CodeWorld can be implemented 
without worrying too much about type checking, however, I would enjoy having a 
solid implementation for the language.</p>

<p>Any thoughts on a good approach to take with this are welcome.</p>


  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/funblocks//2016/05/24/hello-world/">
        Hello World
      </a>
    </h1>

    <span class="post-date">24 May 2016</span>

    <p>So, first off, I got accepted into <a href="https://summer.haskell.org/">Haskell Summer of Code 2016</a>. The project is
to develop a visual functional block based langauge for <a href="https://code.world/">CodeWorld</a>, under <a href="https://cdsmith.wordpress.com/">Chris Smith</a>. 
The project is in the same vein as Scratch, although it will be based on functional principles which will be a subset of Haskell. 
The project idea is described more fully in the <a href="/2016/05/23/project-proposal/">Project Proposal</a></p>

<p>Some of the other goals of this site include me tracking progress of the project and interacting with the community.</p>

<p>I’m a graduate student studying Computer and Electronic Engineering and aside from Summer of Code reasons for doing the project, I’m also interested in
programming languages (and obviously Haskell) and hope to learn a good deal through doing such a project.</p>

<p>P.S. I’m also explicitly giving permission to be included on Planet Haskell</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/funblocks//2016/05/23/project-proposal/">
        Project Proposal
      </a>
    </h1>

    <span class="post-date">23 May 2016</span>

    <h1 id="visual-functional-block-based-programming-language-for-codeworld">Visual functional block-based programming language for CodeWorld</h1>

<h2 id="introduction">Introduction</h2>

<p><img src="http://i.imgur.com/coeFzag.png" alt="blockly" title="blockly" /></p>

<p>The goal of this project is to develop a functional-based visual blocks-based programming language, similar to Scratch and other languages, that is based on a subset of Haskell.
The project will extend CodeWorld and will use its API. The project will feature a user interface to allow the user to snap, drag and drop blocks in order to construct CodeWorld programs.</p>

<p>The language will be a prototype as a full language is beyond the current scope and timeframe. Future work and stretch goals are presented as well.</p>

<p>The project is an extension to CodeWorld, which is an educational web-based programming environment
A visual language is a great way to get students started with programming and a functional language might be well suited to such composition.</p>

<h2 id="outline">Outline</h2>

<h3 id="user-interface">User interface</h3>
<p>Development of a friendly user interface.</p>

<ul>
  <li>A user-friendly interface will be designed and implemented</li>
  <li>Bootstrap or a similar HTML/CSS framework will be used to design the interface. The user interface logic will be implemented using Javascript and Jquery.</li>
  <li>The user interface of the project will utilize <a href="https://developers.google.com/blockly/">Blockly</a>.</li>
  <li>Blockly will be adapted to match the functional style and various blocks will be created in order to match the CodeWorld API.</li>
</ul>

<h3 id="generator">Generator</h3>
<p>Haskell code generation</p>

<ul>
  <li>Blockly applications turn blocks into code in order to execute.</li>
  <li>The project will generate valid Haskell CodeWorld programs from the blocks.</li>
  <li>The code generation will be done using GHCJS with an intermediate block language layer handling the visual language before generating valid CodeWorld code.</li>
</ul>

<h3 id="blocks">Blocks</h3>
<ul>
  <li>Each shape represents a type. A block (that consists of a shape) will have multiple slots or parameters into which other blocks can be inserted.</li>
  <li>Allow creation of top-level definition blocks / functions than can be reused. A separate tab/panel for construction of definitions will be available in the interface</li>
</ul>

<h3 id="validation-and-error-messages">Validation and Error messages</h3>
<p>Validation and verification of a valid program.</p>

<ul>
  <li>Ensure only valid programs can be constructed. Blocks should only be able to be connected if their types match.</li>
  <li>If snapping does not occur, visually tell the user why (tell them what type was expected, if possible)</li>
  <li>If an error does occur it should be displayed in a friendly manner.</li>
  <li>When hovering over a slot it should display what input type is expected.</li>
  <li>Blocks should indicate their output type.</li>
</ul>

<h3 id="polymorphic-types">Polymorphic types</h3>
<p>Some blocks will have to handle polymorphic types.</p>

<ul>
  <li>Blocks may have multiple slots; if a slot gets connected the other slots might change color if the are the same type. 
For example, if we have an IF (condition) (consequence) (alternative) block then when either consequence or alternative is connected the other slot should reflect the same type.</li>
  <li>Blocks might also change color to reflect their type.</li>
  <li>Minimal handling of polymorphic types will be included in order to accommodate CodeWorld’s API. Complete integration is seen as a stretch goal (if time allows).</li>
  <li>User data can be constructed from a set of basic types. Constructors and destructors will allow manipulations of the data.</li>
</ul>

<h3 id="codeworld-integration">CodeWorld integration</h3>
<ul>
  <li>Blocks to reflect CodeWorld functions and data types, such that CodeWorld programs can be built.</li>
  <li>Most CodeWorld functions are monomorphic, however, simulations require a polymorphic state/world type. We propose that such data types be constructed from existing primitive types using constructors and destructors.</li>
</ul>

<h3 id="what-might-need-to-be-excluded">What might need to be excluded</h3>
<ul>
  <li>Custom algebraic data types. Since blocks are predefined there may not be a way to extract data from a user-defined data type.</li>
</ul>

<h2 id="timeline">Timeline</h2>

<p>Weekly communication will be made with the mentor to ensure the project is on track.</p>

<p><strong>Before June 12</strong> - Research into current visual block-based programming languages such as Scratch, what good ideas they utilize and what can be carried over to this project. Research into some of the current problems that a functional based visual programming language faces.</p>

<p><strong>June 12th</strong> - <em>Deliverable</em> - Mock up design of the user interface. Overview of what blocks might be supported.</p>

<p><strong>June 13th - June 30th</strong> - Design of the functional block based language. Set up of CodeWorld and Blockly</p>

<p><strong>July 1st - July 30th</strong> - Setup of a basic interface, incorporate Blockly and interface with CodeWorld. Discover and overcome unsuspected challenges</p>

<p><strong>July 31st</strong> - <em>Deliverable</em> - Basic user interface set up. A basic program should be able to built using the user interface.</p>

<p><strong>August 1st - August 15th</strong> - Implement Codeworld functions and types. Complete Blockly code generation.</p>

<p><strong>August 16th</strong> - <em>Deliverable</em> - CodeWorld example programs should be able to be built.</p>

<p><strong>August 16th - September 2nd</strong> - Polish user interface, improve error messages, fix bugs. Some leeway for the unexpected.</p>

<p>I have limited availability from 4 - 7 September due to a conference. It does not seem to interfere with any important dates.</p>

<p>I will communicate with my mentor if there are any other difficulties.</p>

<h2 id="stretch-goals">Stretch Goals</h2>

<p>If time allows and a good solution presents itself the following may be implemented (but is not part of the core project), otherwise they are presented as good ideas for future versions:</p>

<ul>
  <li>Pattern Matching</li>
  <li>Support for ADT’s</li>
  <li>Support for editing list comprehensions, live previews of list comprehensions</li>
  <li>Full recursion support</li>
  <li>First class functions</li>
</ul>

<h2 id="about-me">About me</h2>

<table>
  <thead>
    <tr>
      <th> </th>
      <th style="text-align: center"> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Name</td>
      <td style="text-align: center">Stefan Jacholke</td>
    </tr>
    <tr>
      <td>University</td>
      <td style="text-align: center">NWU Potchefstroom</td>
    </tr>
    <tr>
      <td>Course</td>
      <td style="text-align: center">M.Eng Computer</td>
    </tr>
    <tr>
      <td>Degree</td>
      <td style="text-align: center">B.Eng Computer and Electronic</td>
    </tr>
    <tr>
      <td>Email</td>
      <td style="text-align: center">stefanjacholke@gmail.com</td>
    </tr>
    <tr>
      <td>Github</td>
      <td style="text-align: center"><a href="https://github.com/stefan-j">https://github.com/stefan-j</a></td>
    </tr>
  </tbody>
</table>

<p>I’m a first-year computer engineering graduate student at NWU in South Africa, studying Network Optimization and Planning.</p>

<p>My current interests include Programming Languages, Algorithms, and Data structures.</p>

<p>While I have only recently started developing in Haskell I have used it for:</p>

<ul>
  <li>Developing my own simple programming language</li>
  <li>Developed a simple math expression simplifier</li>
  <li>Am currently developing a mobile coffee purchases mobile application; the backend for the application is written in Haskell (that handles credit card purchases, queries to the POS system, interface between app and
  database)</li>
  <li>Using Haskell for algorithmic problems (HackerRank, Codejam)</li>
  <li>Used <a href="https://github.com/stefan-j/cplex-haskell">FFI binding to interface with CPLEX</a> (commercial linear programming solver)</li>
  <li>Using it to develop my framework for Metro Ethernet optimization  (Master’s project)</li>
</ul>

<p>I have experience in Web development, mostly through some of my pregraduate
courses. In particular, I have:</p>

<ul>
  <li>Developed a Real Estate web site for advertisements using ASP.NET, MySQL, and ReactJS</li>
  <li>Developed a File management site for uploading and downloading files (similar to dropbox, though simpler) using PHP, Bootstrap and Jquery and AJAX</li>
</ul>

<p>Various experience with other technologies (though unrelated to project at hand). I also have a few other projects in different languages.</p>

<p>I have some small open source contributions listed on my Github profile.</p>

<p>More information can be given on request.</p>

<h2 id="sources">Sources</h2>
<p>This project is based on Chris Smith’s <a href="https://github.com/google/codeworld/issues/85">proposal for a block-based UI for CodeWorld</a></p>


  </div>
  
</div>

<div class="pagination">
  
    <span class="pagination-item older">Older</span>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
